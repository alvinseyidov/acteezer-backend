{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title }} - Acteezer{% endblock %}

{% block extra_css %}
<style>
:root {
    --primary: #5DD3BE;
    --primary-dark: #4BC5AA;
    --primary-light: #7CDDC9;
    --secondary: #4DB8E8;
    --accent: #FFB84D;
    --text-dark: #1a2e2a;
    --text-gray: #64748b;
    --bg-light: #f8fdfc;
    --bg-white: #ffffff;
    --border-color: #e0f2ef;
    --gradient-primary: linear-gradient(135deg, #5DD3BE 0%, #4BC5AA 100%);
    --gradient-soft: linear-gradient(135deg, rgba(93, 211, 190, 0.1) 0%, rgba(75, 197, 170, 0.1) 100%);
    --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.15);
    --shadow-primary: 0 8px 25px rgba(93, 211, 190, 0.3);
    --radius: 16px;
    --radius-lg: 24px;
}

* {
    box-sizing: border-box;
}

.create-activity-wrapper {
    background: linear-gradient(135deg, #f8fdfc 0%, #f0faf8 100%);
    min-height: 100vh;
    padding: 2rem 0 4rem;
    position: relative;
    overflow-x: hidden;
}

.create-activity-wrapper::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 300px;
    background: var(--gradient-soft);
    z-index: 0;
}

.create-activity-container {
    position: relative;
    z-index: 1;
    max-width: 1000px;
    margin: 0 auto;
    padding: 0 1rem;
}

/* Breadcrumb */
.breadcrumb-modern {
    background: transparent;
    padding: 0;
    margin-bottom: 2rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.breadcrumb-modern a {
    color: var(--primary);
    text-decoration: none;
    font-weight: 500;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.breadcrumb-modern a:hover {
    color: var(--primary-dark);
    transform: translateX(2px);
}

.breadcrumb-modern .separator {
    color: var(--text-gray);
    opacity: 0.5;
}

.breadcrumb-modern .active {
    color: var(--text-gray);
    font-weight: 600;
}

/* Hero Header */
.hero-header {
    text-align: center;
    margin-bottom: 3rem;
    padding: 2rem 0;
}

.hero-icon {
    width: 100px;
    height: 100px;
    margin: 0 auto 1.5rem;
    background: var(--gradient-primary);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5rem;
    color: white;
    box-shadow: var(--shadow-primary);
    position: relative;
    animation: float 3s ease-in-out infinite;
}

.hero-icon::after {
    content: '';
    position: absolute;
    inset: -4px;
    border-radius: 50%;
    background: var(--gradient-primary);
    opacity: 0.2;
    z-index: -1;
    animation: pulse 2s ease-in-out infinite;
}

@keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
}

@keyframes pulse {
    0%, 100% { transform: scale(1); opacity: 0.2; }
    50% { transform: scale(1.1); opacity: 0.1; }
}

.hero-header h1 {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 0.75rem;
    background: linear-gradient(135deg, var(--text-dark) 0%, var(--primary-dark) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.hero-header p {
    font-size: 1.125rem;
    color: var(--text-gray);
    margin: 0;
}

/* Main Form Card */
.form-card-modern {
    background: var(--bg-white);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    overflow: hidden;
    margin-bottom: 2rem;
    border: 1px solid var(--border-color);
    transition: all 0.3s ease;
}

.form-card-modern:hover {
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.12);
}

/* Form Sections */
.form-section-modern {
    padding: 2.5rem;
    border-bottom: 1px solid var(--border-color);
    transition: all 0.3s ease;
}

.form-section-modern:last-child {
    border-bottom: none;
}

.form-section-modern:hover {
    background: linear-gradient(to right, rgba(93, 211, 190, 0.02), transparent);
}

.section-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid var(--gradient-soft);
}

.section-icon {
    width: 50px;
    height: 50px;
    background: var(--gradient-soft);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary-dark);
    font-size: 1.5rem;
    flex-shrink: 0;
}

.section-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-dark);
    margin: 0;
    flex: 1;
}

.section-description {
    font-size: 0.95rem;
    color: var(--text-gray);
    margin-top: 0.25rem;
}

/* Form Groups */
.form-group-modern {
    margin-bottom: 1.75rem;
    position: relative;
}

.form-group-modern:last-child {
    margin-bottom: 0;
}

.form-label-modern {
    display: block;
    font-weight: 600;
    color: var(--text-dark);
    margin-bottom: 0.75rem;
    font-size: 0.95rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.form-label-modern .required {
    color: #FF6B6B;
    font-weight: 700;
}

/* Floating Input Style */
.form-control-modern,
.form-select-modern {
    width: 100%;
    padding: 1rem 1.25rem;
    font-size: 1rem;
    border: 2px solid var(--border-color);
    border-radius: var(--radius);
    background: var(--bg-white);
    color: var(--text-dark);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    font-family: 'Poppins', sans-serif;
}

.form-control-modern:focus,
.form-select-modern:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(93, 211, 190, 0.1);
    transform: translateY(-1px);
}

.form-control-modern::placeholder {
    color: var(--text-gray);
    opacity: 0.6;
}

textarea.form-control-modern {
    min-height: 140px;
    resize: vertical;
    line-height: 1.6;
}

/* Grid Layouts */
.form-grid-2 {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
}

.form-grid-3 {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
}

/* Help Text */
.form-help-modern {
    font-size: 0.875rem;
    color: var(--text-gray);
    margin-top: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    opacity: 0.8;
}

.form-help-modern i {
    font-size: 0.75rem;
    color: var(--primary);
}

/* Image Upload Area */
.image-upload-modern {
    border: 3px dashed var(--border-color);
    border-radius: var(--radius-lg);
    padding: 3rem 2rem;
    text-align: center;
    background: var(--gradient-soft);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    position: relative;
    overflow: hidden;
}

.image-upload-modern::before {
    content: '';
    position: absolute;
    inset: 0;
    background: var(--gradient-primary);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.image-upload-modern:hover {
    border-color: var(--primary);
    background: rgba(93, 211, 190, 0.05);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.image-upload-modern:hover::before {
    opacity: 0.05;
}

.image-upload-modern.dragover {
    border-color: var(--primary-dark);
    background: rgba(93, 211, 190, 0.1);
    transform: scale(1.02);
}

.upload-icon-wrapper {
    position: relative;
    z-index: 1;
    margin-bottom: 1rem;
}

.upload-icon-modern {
    font-size: 4rem;
    color: var(--primary);
    margin-bottom: 1rem;
    display: inline-block;
    transition: all 0.3s ease;
}

.image-upload-modern:hover .upload-icon-modern {
    transform: scale(1.1) rotate(5deg);
    color: var(--primary-dark);
}

.upload-text h5 {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-dark);
    margin-bottom: 0.5rem;
    position: relative;
    z-index: 1;
}

.upload-text p {
    color: var(--text-gray);
    margin: 0;
    position: relative;
    z-index: 1;
}

.file-input-hidden {
    display: none;
}

/* Image Preview */
.preview-wrapper {
    margin-top: 1.5rem;
    text-align: center;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

.image-preview-modern {
    max-width: 100%;
    max-height: 300px;
    border-radius: var(--radius);
    box-shadow: var(--shadow-md);
    margin-bottom: 1rem;
    border: 3px solid var(--primary-light);
}

/* Map Container */
.map-container {
    border-radius: var(--radius);
    overflow: hidden;
    height: 300px;
    margin-top: 1rem;
    border: 2px solid var(--border-color);
}

#activity-map {
    width: 100%;
    height: 100%;
}

.location-selected {
    display: none;
    margin-top: 1rem;
    padding: 1rem;
    background: var(--gradient-soft);
    border-radius: var(--radius);
    border-left: 4px solid var(--primary);
    color: var(--text-dark);
    font-size: 0.9rem;
}

.location-selected.show {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.location-selected i {
    color: var(--primary);
    font-size: 1.25rem;
}

/* Language Dropdown */
.language-dropdown-container {
    position: relative;
}

.language-dropdown-trigger {
    width: 100%;
    padding: 1rem 1.25rem;
    font-size: 1rem;
    border: 2px solid var(--border-color);
    border-radius: var(--radius);
    background: var(--bg-white);
    color: var(--text-gray);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: all 0.3s ease;
}

.language-dropdown-trigger:hover,
.language-dropdown-trigger.active {
    border-color: var(--primary);
}

.language-dropdown-trigger i {
    transition: transform 0.3s ease;
}

.language-dropdown-trigger.active i {
    transform: rotate(180deg);
}

.language-dropdown-menu {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: var(--bg-white);
    border: 2px solid var(--primary);
    border-radius: var(--radius);
    margin-top: 0.5rem;
    max-height: 250px;
    overflow-y: auto;
    z-index: 100;
    box-shadow: var(--shadow-md);
}

.language-dropdown-menu.show {
    display: block;
}

.language-option {
    padding: 0.75rem 1rem;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.language-option:hover {
    background: var(--gradient-soft);
}

.language-option.selected {
    background: var(--gradient-soft);
    color: var(--primary-dark);
    font-weight: 600;
}

.language-option i {
    color: var(--primary);
    opacity: 0;
}

.language-option.selected i {
    opacity: 1;
}

.selected-languages {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 0.75rem;
}

.language-tag {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.4rem 0.75rem;
    background: var(--gradient-soft);
    border: 2px solid var(--primary);
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 500;
    color: var(--primary-dark);
}

.language-tag .remove-tag {
    cursor: pointer;
    font-size: 0.75rem;
    color: #FF6B6B;
    margin-left: 0.25rem;
}

.language-tag .remove-tag:hover {
    color: #ff4444;
}

/* Gender Selection Compact */
.gender-selection-compact {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
}

.gender-option-compact {
    display: none;
}

.gender-label-compact {
    padding: 0.75rem 1.25rem;
    background: var(--bg-white);
    border: 2px solid var(--border-color);
    border-radius: 25px;
    cursor: pointer;
    font-weight: 500;
    font-size: 0.9rem;
    color: var(--text-dark);
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.gender-label-compact:hover {
    border-color: var(--primary-light);
}

.gender-option-compact:checked + .gender-label-compact {
    background: var(--primary);
    border-color: var(--primary);
    color: white;
    box-shadow: var(--shadow-primary);
}

/* Form Footer */
.form-footer-modern {
    background: linear-gradient(135deg, rgba(93, 211, 190, 0.05) 0%, rgba(75, 197, 170, 0.02) 100%);
    padding: 2rem 2.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-top: 1px solid var(--border-color);
    flex-wrap: wrap;
    gap: 1.5rem;
}

.footer-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    color: var(--text-gray);
    font-size: 0.9rem;
}

.footer-info i {
    color: var(--primary);
}

.footer-actions {
    display: flex;
    gap: 1rem;
}

/* Buttons */
.btn-modern {
    padding: 1rem 2.5rem;
    font-size: 1rem;
    font-weight: 600;
    border-radius: var(--radius);
    border: none;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    font-family: 'Poppins', sans-serif;
    position: relative;
    overflow: hidden;
}

.btn-modern::before {
    content: '';
    position: absolute;
    inset: 0;
    background: white;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.btn-modern span {
    position: relative;
    z-index: 1;
}

.btn-modern i {
    position: relative;
    z-index: 1;
}

.btn-primary-modern {
    background: var(--gradient-primary);
    color: white;
    box-shadow: var(--shadow-primary);
}

.btn-primary-modern:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 35px rgba(93, 211, 190, 0.4);
    color: white;
}

.btn-primary-modern:active {
    transform: translateY(-1px);
}

.btn-secondary-modern {
    background: var(--bg-white);
    color: var(--text-gray);
    border: 2px solid var(--border-color);
}

.btn-secondary-modern:hover {
    background: var(--bg-light);
    border-color: var(--primary-light);
    color: var(--text-dark);
    transform: translateY(-2px);
    box-shadow: var(--shadow-sm);
}

.btn-danger-modern {
    background: #FF6B6B;
    color: white;
}

.btn-danger-modern:hover {
    background: #ff5252;
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
    color: white;
}

/* Loading State */
.btn-modern.loading {
    pointer-events: none;
    opacity: 0.7;
}

.btn-modern.loading i {
    animation: spin 1s linear infinite;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* Responsive */
@media (max-width: 768px) {
    .create-activity-wrapper {
        padding: 1rem 0 2rem;
    }
    
    .hero-header h1 {
        font-size: 2rem;
    }
    
    .form-section-modern {
        padding: 1.5rem;
    }
    
    .section-title {
        font-size: 1.25rem;
    }
    
    .form-grid-2,
    .form-grid-3 {
        grid-template-columns: 1fr;
    }
    
    /* Date/Time responsive - start in one row, end in another */
    .datetime-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.75rem;
    }
    
    .datetime-row .form-group-modern {
        margin-bottom: 0;
    }
    
    /* Participants and Price in same row */
    .participants-price-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.75rem;
    }
    
    .participants-price-row .form-group-modern {
        margin-bottom: 0;
    }
    
    /* Age fields in same row */
    .age-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.75rem;
    }
    
    .age-row .form-group-modern {
        margin-bottom: 0;
    }
    
    /* Gender compact in row */
    .gender-selection-compact {
        display: flex;
        flex-wrap: nowrap;
        gap: 0.5rem;
    }
    
    .gender-label-compact {
        padding: 0.6rem 1rem;
        font-size: 0.85rem;
        flex: 1;
        justify-content: center;
    }
    
    .form-footer-modern {
        flex-direction: column;
        align-items: stretch;
    }
    
    .footer-actions {
        flex-direction: column;
    }
    
    .btn-modern {
        width: 100%;
        justify-content: center;
    }
}

/* Smooth Scroll */
html {
    scroll-behavior: smooth;
}

/* Custom Scrollbar */
::-webkit-scrollbar {
    width: 10px;
}

::-webkit-scrollbar-track {
    background: var(--bg-light);
}

::-webkit-scrollbar-thumb {
    background: var(--primary-light);
    border-radius: 5px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--primary);
}
</style>
{% endblock %}

{% block content %}
<div class="create-activity-wrapper">
    <div class="create-activity-container">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="breadcrumb-modern">
            <a href="{% url 'activities:activities_list' %}">
                <i class="fas fa-arrow-left"></i>
                <span>Aktivitələr</span>
            </a>
            <span class="separator">/</span>
            <span class="active">Yeni Aktivitə Yarat</span>
        </nav>

        <!-- Hero Header -->
        <div class="hero-header">
            <div class="hero-icon">
                <i class="fas fa-plus"></i>
            </div>
            <h1>Yeni Aktivitə Yarat</h1>
            <p>İnsanları bir araya gətirən unikal bir təcrübə yaradın</p>
        </div>

        <!-- Main Form -->
        <form method="post" enctype="multipart/form-data" id="create-activity-form" novalidate>
            {% csrf_token %}
            
            <div class="form-card-modern">
                <!-- Basic Information -->
                <div class="form-section-modern">
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div>
                            <h3 class="section-title">Əsas Məlumatlar</h3>
                            <p class="section-description">Aktivitənizin əsas xüsusiyyətlərini daxil edin</p>
                        </div>
                    </div>
                    
                    <div class="form-group-modern">
                        <label for="title" class="form-label-modern">
                            Aktivitə Adı
                            <span class="required">*</span>
                        </label>
                        <input type="text" class="form-control-modern" id="title" name="title" 
                               placeholder="Məsələn: Parkda gəzinti" required maxlength="200">
                    </div>
                    
                    <div class="form-group-modern">
                        <label for="category" class="form-label-modern">
                            Kateqoriya
                            <span class="required">*</span>
                        </label>
                        <select class="form-select-modern" id="category" name="category" required>
                            <option value="">Kateqoriya seçin</option>
                            {% for category in categories %}
                                <option value="{{ category.id }}">{{ category.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="form-group-modern">
                        <label for="description" class="form-label-modern">
                            Ətraflı Təsvir
                        </label>
                        <textarea class="form-control-modern" id="description" name="description" 
                                  placeholder="Aktivitə haqqında ətraflı məlumat verin..."></textarea>
                        <div class="form-help-modern">
                            <i class="fas fa-lightbulb"></i>
                            <span>İsteğe bağlı - Ətraflı təsvir iştirakçıların aktivitəni daha yaxşı başa düşməsinə kömək edir.</span>
                        </div>
                    </div>
                </div>

                <!-- Date & Time -->
                <div class="form-section-modern">
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div>
                            <h3 class="section-title">Tarix və Vaxt</h3>
                            <p class="section-description">Aktivitənin başlama və bitmə vaxtını təyin edin</p>
                        </div>
                    </div>
                    
                    <!-- Start Date & Time Row -->
                    <div class="form-grid-2 datetime-row" style="margin-bottom: 1.5rem;">
                        <div class="form-group-modern">
                            <label for="start_date" class="form-label-modern">
                                Başlama Tarixi
                                <span class="required">*</span>
                            </label>
                            <input type="date" class="form-control-modern" id="start_date" name="start_date" required autocomplete="off">
                        </div>
                        <div class="form-group-modern">
                            <label for="start_time" class="form-label-modern">
                                Başlama Vaxtı
                                <span class="required">*</span>
                            </label>
                            <input type="time" class="form-control-modern" id="start_time" name="start_time" required autocomplete="off">
                        </div>
                    </div>
                    
                    <!-- End Date & Time Row (Optional) -->
                    <div class="form-grid-2 datetime-row">
                        <div class="form-group-modern">
                            <label for="end_date" class="form-label-modern">Bitmə Tarixi</label>
                            <input type="date" class="form-control-modern" id="end_date" name="end_date" autocomplete="off">
                        </div>
                        <div class="form-group-modern">
                            <label for="end_time" class="form-label-modern">Bitmə Vaxtı</label>
                            <input type="time" class="form-control-modern" id="end_time" name="end_time" autocomplete="off">
                        </div>
                    </div>
                    <div class="form-help-modern" style="margin-top: 0.5rem;">
                        <i class="fas fa-clock"></i>
                        <span>İsteğe bağlı - Boş buraxırsanız, başlama tarixindən 3 saat sonra avtomatik təyin ediləcək</span>
                    </div>
                </div>

                <!-- Location & Participants -->
                <div class="form-section-modern">
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div>
                            <h3 class="section-title">Yer və İştirakçılar</h3>
                            <p class="section-description">Aktivitənin keçiriləcəyi yeri və iştirakçı sayını bildirin</p>
                        </div>
                    </div>
                    
                    <div class="form-group-modern">
                        <label for="address" class="form-label-modern">
                            Ünvan
                            <span class="required">*</span>
                        </label>
                        <input type="text" class="form-control-modern" id="address" name="address" 
                               placeholder="Ünvan, şəhər və ya məkan adı daxil edin..." required maxlength="300" autocomplete="off">
                        <div class="form-help-modern">
                            <i class="fas fa-info-circle"></i>
                            <span>Xəritədən marker-i sürüşdürərək dəqiq yeri seçə bilərsiniz</span>
                        </div>
                    </div>
                    
                    <div class="map-container" id="map-container">
                        <div id="activity-map"></div>
                    </div>
                    
                    <div class="location-selected" id="location-selected">
                        <i class="fas fa-check-circle"></i>
                        <span><strong>Seçilmiş məkan:</strong> <span id="selected-location"></span></span>
                    </div>
                    
                    <input type="hidden" id="latitude" name="latitude">
                    <input type="hidden" id="longitude" name="longitude">
                    
                    <div class="form-grid-2 participants-price-row" style="margin-top: 1.5rem;">
                        <div class="form-group-modern">
                            <label for="max_participants" class="form-label-modern">
                                İştirakçı sayı
                                <span class="required">*</span>
                            </label>
                            <input type="number" class="form-control-modern" id="max_participants" name="max_participants" 
                                   placeholder="Məs: 20" required min="2" max="1000">
                        </div>
                        <div class="form-group-modern">
                            <label for="price" class="form-label-modern">Qiymət (AZN)</label>
                            <input type="number" class="form-control-modern" id="price" name="price" 
                                   placeholder="0.00" min="0" step="0.01">
                            <div class="form-help-modern">
                                <i class="fas fa-money-bill-wave"></i>
                                <span>Pulsuzsa boş buraxın</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Participant Requirements -->
                <div class="form-section-modern">
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div>
                            <h3 class="section-title">İştirakçı Tələbləri</h3>
                            <p class="section-description">Aktivitəyə qoşulmaq üçün tələb olunan şərtlər</p>
                        </div>
                    </div>
                    
                    <!-- Age Row -->
                    <div class="form-grid-2 age-row" style="margin-bottom: 1.5rem;">
                        <div class="form-group-modern">
                            <label for="min_age" class="form-label-modern">Minimum Yaş</label>
                            <input type="number" class="form-control-modern" id="min_age" name="min_age" 
                                   placeholder="Məs: 18" min="1" max="100">
                        </div>
                        <div class="form-group-modern">
                            <label for="max_age" class="form-label-modern">Maksimum Yaş</label>
                            <input type="number" class="form-control-modern" id="max_age" name="max_age" 
                                   placeholder="Məs: 65" min="1" max="100">
                        </div>
                    </div>
                    
                    <!-- Language Dropdown -->
                    <div class="form-group-modern">
                        <label class="form-label-modern">Tələb olunan Dillər</label>
                        <div class="language-dropdown-container">
                            <div class="language-dropdown-trigger" id="language-trigger" onclick="toggleLanguageDropdown()">
                                <span>Dil seçin...</span>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="language-dropdown-menu" id="language-menu">
                                {% for language in languages %}
                                <div class="language-option" data-id="{{ language.id }}" data-name="{{ language.name }}" onclick="toggleLanguage({{ language.id }}, '{{ language.name }}')">
                                    <i class="fas fa-check"></i>
                                    <span>{{ language.name }}</span>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="selected-languages" id="selected-languages"></div>
                        <div class="form-help-modern">
                            <i class="fas fa-language"></i>
                            <span>İsteğe bağlı - İştirakçıların bilməli olduğu dillər</span>
                        </div>
                    </div>
                    
                    <!-- Gender Selection Compact -->
                    <div class="form-group-modern">
                        <label class="form-label-modern">İcazə verilən Cinsiyyətlər</label>
                        <div class="gender-selection-compact">
                            <input type="radio" class="gender-option-compact" name="gender_choice" value="all" id="gender_all" checked>
                            <label for="gender_all" class="gender-label-compact">
                                <i class="fas fa-users"></i>
                                <span>Fərqi yoxdur</span>
                            </label>
                            
                            <input type="radio" class="gender-option-compact" name="gender_choice" value="male" id="gender_male_only">
                            <label for="gender_male_only" class="gender-label-compact">
                                <i class="fas fa-mars"></i>
                                <span>Kişi</span>
                            </label>
                            
                            <input type="radio" class="gender-option-compact" name="gender_choice" value="female" id="gender_female_only">
                            <label for="gender_female_only" class="gender-label-compact">
                                <i class="fas fa-venus"></i>
                                <span>Qadın</span>
                            </label>
                        </div>
                        <!-- Hidden inputs to store actual gender values -->
                        <input type="hidden" name="allowed_genders" id="allowed_genders_hidden" value="male,female,other,prefer_not_to_say">
                    </div>
                </div>

                <!-- Additional Information -->
                <div class="form-section-modern">
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-list-ul"></i>
                        </div>
                        <div>
                            <h3 class="section-title">Əlavə Məlumatlar</h3>
                            <p class="section-description">İştirakçılar üçün əlavə qeydlər və tələblər</p>
                        </div>
                    </div>
                    
                    <div class="form-group-modern">
                        <label for="requirements" class="form-label-modern">Tələblər və Qeydlər</label>
                        <textarea class="form-control-modern" id="requirements" name="requirements" 
                                  placeholder="İştirakçılar üçün xüsusi tələblər, gətirməli əşyalar və s."></textarea>
                        <div class="form-help-modern">
                            <i class="fas fa-clipboard-list"></i>
                            <span>İştirakçıların bilməli olduğu əlavə məlumatlar</span>
                        </div>
                    </div>
                </div>

                <!-- Image Upload -->
                <div class="form-section-modern">
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-image"></i>
                        </div>
                        <div>
                            <h3 class="section-title">Aktivitə Şəkli</h3>
                            <p class="section-description">Aktivitəni daha cəlbedici etmək üçün şəkil əlavə edin</p>
                        </div>
                    </div>
                    
                    <div class="image-upload-modern" onclick="document.getElementById('main_image').click()">
                        <div class="upload-icon-wrapper">
                            <i class="fas fa-cloud-upload-alt upload-icon-modern"></i>
                        </div>
                        <div class="upload-text">
                            <h5>Şəkil Yüklə</h5>
                            <p>Faylı buraya sürükləyin və ya klikləyin</p>
                        </div>
                        <input type="file" class="file-input-hidden" id="main_image" name="main_image" accept="image/*">
                    </div>
                    
                    <div class="preview-wrapper" id="preview-container" style="display: none;">
                        <img id="image-preview" class="image-preview-modern" alt="Preview">
                        <div style="margin-top: 1rem;">
                            <button type="button" class="btn-modern btn-danger-modern" onclick="removeImage()">
                                <i class="fas fa-trash"></i>
                                <span>Şəkli Sil</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Form Footer -->
            <div class="form-footer-modern">
                <div class="footer-info">
                    <i class="fas fa-info-circle"></i>
                    <span><span class="required">*</span> olan sahələr məcburidir</span>
                </div>
                <div class="footer-actions">
                    <a href="{% url 'activities:activities_list' %}" class="btn-modern btn-secondary-modern">
                        <i class="fas fa-times"></i>
                        <span>Ləğv et</span>
                    </a>
                    <button type="submit" class="btn-modern btn-primary-modern" id="submit-btn">
                        <i class="fas fa-plus"></i>
                        <span>Aktivitə Yarat</span>
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Load Google Maps Script -->
<script>
(function() {
    const script = document.createElement('script');
    script.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyAoWtRW8FvOvwdDOfdbHdzzcC989ZUM9zg&libraries=places&language=az';
    script.async = true;
    script.defer = true;
    script.onload = function() {
        setTimeout(function() {
            if (typeof google !== 'undefined' && google.maps && typeof initActivityMap === 'function') {
                initActivityMap();
            }
        }, 100);
    };
    document.head.appendChild(script);
})();
</script>

<script>
console.log('Create activity script loaded');

let map;
let marker;
let geocoder;
let autocomplete;
let isMapInitialized = false;
let selectedLanguages = new Set();

// Initialize Google Map for Activity
function initActivityMap() {
    if (isMapInitialized) return;
    
    if (typeof google === 'undefined' || !google.maps || !google.maps.Map) {
        console.error('Google Maps not loaded yet');
        return;
    }
    
    isMapInitialized = true;
    console.log('Initializing Activity Map...');
    
    const defaultLocation = { lat: 40.4093, lng: 49.8671 };
    
    geocoder = new google.maps.Geocoder();
    
    map = new google.maps.Map(document.getElementById('activity-map'), {
        center: defaultLocation,
        zoom: 12,
        styles: [
            {
                featureType: "poi",
                elementType: "labels",
                stylers: [{ visibility: "off" }]
            }
        ]
    });
    
    marker = new google.maps.Marker({
        position: defaultLocation,
        map: map,
        draggable: true,
        animation: google.maps.Animation.DROP,
        title: 'Yerinizi seçin və ya marker-i sürüşdürün'
    });
    
    marker.addListener('dragend', function(event) {
        const position = {
            lat: event.latLng.lat(),
            lng: event.latLng.lng()
        };
        updateLocationFromCoordinates(position);
    });
    
    map.addListener('click', function(event) {
        const position = {
            lat: event.latLng.lat(),
            lng: event.latLng.lng()
        };
        marker.setPosition(event.latLng);
        updateLocationFromCoordinates(position);
    });
    
    const addressInput = document.getElementById('address');
    autocomplete = new google.maps.places.Autocomplete(addressInput, {
        types: ['geocode', 'establishment'],
        componentRestrictions: { country: 'az' }
    });
    
    autocomplete.addListener('place_changed', function() {
        const place = autocomplete.getPlace();
        
        if (!place.geometry) return;
        
        const position = {
            lat: place.geometry.location.lat(),
            lng: place.geometry.location.lng()
        };
        
        map.setCenter(place.geometry.location);
        map.setZoom(15);
        marker.setPosition(place.geometry.location);
        
        document.getElementById('latitude').value = position.lat;
        document.getElementById('longitude').value = position.lng;
        
        showLocationSelected(place.formatted_address || addressInput.value);
    });
}

function updateLocationFromCoordinates(position) {
    document.getElementById('latitude').value = position.lat;
    document.getElementById('longitude').value = position.lng;
    
    geocoder.geocode({ location: position }, function(results, status) {
        if (status === 'OK' && results[0]) {
            const address = results[0].formatted_address;
            document.getElementById('address').value = address;
            showLocationSelected(address);
        }
    });
}

function showLocationSelected(address) {
    const locationDiv = document.getElementById('location-selected');
    const locationText = document.getElementById('selected-location');
    locationText.textContent = address;
    locationDiv.classList.add('show');
}

// Language dropdown functions
function toggleLanguageDropdown() {
    const trigger = document.getElementById('language-trigger');
    const menu = document.getElementById('language-menu');
    trigger.classList.toggle('active');
    menu.classList.toggle('show');
}

function toggleLanguage(id, name) {
    const option = document.querySelector(`.language-option[data-id="${id}"]`);
    
    if (selectedLanguages.has(id)) {
        selectedLanguages.delete(id);
        option.classList.remove('selected');
    } else {
        selectedLanguages.add(id);
        option.classList.add('selected');
    }
    
    updateSelectedLanguagesDisplay();
    updateLanguageTriggerText();
}

function removeLanguage(id) {
    selectedLanguages.delete(id);
    const option = document.querySelector(`.language-option[data-id="${id}"]`);
    if (option) option.classList.remove('selected');
    updateSelectedLanguagesDisplay();
    updateLanguageTriggerText();
}

function updateSelectedLanguagesDisplay() {
    const container = document.getElementById('selected-languages');
    container.innerHTML = '';
    
    selectedLanguages.forEach(id => {
        const option = document.querySelector(`.language-option[data-id="${id}"]`);
        if (option) {
            const name = option.getAttribute('data-name');
            const tag = document.createElement('div');
            tag.className = 'language-tag';
            tag.innerHTML = `
                <span>${name}</span>
                <span class="remove-tag" onclick="removeLanguage(${id})"><i class="fas fa-times"></i></span>
                <input type="hidden" name="required_languages" value="${id}">
            `;
            container.appendChild(tag);
        }
    });
}

function updateLanguageTriggerText() {
    const trigger = document.getElementById('language-trigger');
    const span = trigger.querySelector('span');
    if (selectedLanguages.size > 0) {
        span.textContent = `${selectedLanguages.size} dil seçildi`;
    } else {
        span.textContent = 'Dil seçin...';
    }
}

// Close dropdown when clicking outside
document.addEventListener('click', function(e) {
    const container = document.querySelector('.language-dropdown-container');
    if (container && !container.contains(e.target)) {
        document.getElementById('language-trigger').classList.remove('active');
        document.getElementById('language-menu').classList.remove('show');
    }
});

// Gender selection handling
document.querySelectorAll('input[name="gender_choice"]').forEach(radio => {
    radio.addEventListener('change', function() {
        const hiddenInput = document.getElementById('allowed_genders_hidden');
        if (this.value === 'all') {
            hiddenInput.value = 'male,female,other,prefer_not_to_say';
        } else if (this.value === 'male') {
            hiddenInput.value = 'male';
        } else if (this.value === 'female') {
            hiddenInput.value = 'female';
        }
    });
});

// Disable HTML5 validation
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('create-activity-form');
    if (form) {
        form.setAttribute('novalidate', 'true');
        
        const formElements = form.querySelectorAll('input, select, textarea');
        formElements.forEach(element => {
            element.addEventListener('invalid', function(e) {
                e.preventDefault();
                element.setCustomValidity('');
            });
        });
    }
    
    // Set minimum date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('start_date').min = today;
    document.getElementById('end_date').min = today;
    
    // Auto-fill end date based on start date
    document.getElementById('start_date').addEventListener('change', function() {
        const startDate = this.value;
        const endDateField = document.getElementById('end_date');
        if (startDate && !endDateField.value) {
            endDateField.value = startDate;
        }
    });
});

// Image upload handling
const imageInput = document.getElementById('main_image');
const uploadArea = document.querySelector('.image-upload-modern');
const previewContainer = document.getElementById('preview-container');
const imagePreview = document.getElementById('image-preview');

imageInput.addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            imagePreview.src = e.target.result;
            previewContainer.style.display = 'block';
        };
        reader.readAsDataURL(file);
    }
});

function removeImage() {
    imageInput.value = '';
    previewContainer.style.display = 'none';
}

// Drag and drop for image upload
uploadArea.addEventListener('dragover', function(e) {
    e.preventDefault();
    uploadArea.classList.add('dragover');
});

uploadArea.addEventListener('dragleave', function(e) {
    e.preventDefault();
    uploadArea.classList.remove('dragover');
});

uploadArea.addEventListener('drop', function(e) {
    e.preventDefault();
    uploadArea.classList.remove('dragover');
    
    const files = e.dataTransfer.files;
    if (files.length > 0 && files[0].type.startsWith('image/')) {
        imageInput.files = files;
        imageInput.dispatchEvent(new Event('change'));
    }
});

// Form validation and submission
document.getElementById('create-activity-form').addEventListener('submit', function(e) {
    console.log('Form submission started');
    
    const submitBtn = document.getElementById('submit-btn');
    if (submitBtn.disabled) {
        e.preventDefault();
        return;
    }
    
    // Basic required field validation
    const requiredFields = ['title', 'category', 'start_date', 'start_time', 'address', 'max_participants'];
    let missingFields = [];
    
    for (const fieldName of requiredFields) {
        const field = document.getElementById(fieldName) || document.querySelector(`[name="${fieldName}"]`);
        if (!field || !field.value.trim()) {
            missingFields.push(fieldName);
        }
    }
    
    if (missingFields.length > 0) {
        e.preventDefault();
        alert('Zəhmət olmasa bütün məcburi sahələri doldurun: ' + missingFields.join(', '));
        return;
    }
    
    // Date validation
    const startDate = document.getElementById('start_date').value;
    const startTime = document.getElementById('start_time').value;
    const endDate = document.getElementById('end_date').value;
    const endTime = document.getElementById('end_time').value;
    
    if (startDate && startTime) {
        const startDateTime = new Date(startDate + 'T' + startTime);
        const now = new Date();
        
        if (startDateTime <= now) {
            e.preventDefault();
            alert('Aktivitə tarixi indiki vaxtdan sonra olmalıdır.');
            return;
        }
        
        if (endDate && endTime) {
            const endDateTime = new Date(endDate + 'T' + endTime);
            if (endDateTime <= startDateTime) {
                e.preventDefault();
                alert('Bitmə tarixi başlama tarixindən sonra olmalıdır.');
                return;
            }
        }
    }
    
    // Age range validation
    const minAge = document.getElementById('min_age').value;
    const maxAge = document.getElementById('max_age').value;
    if (minAge && maxAge && parseInt(minAge) >= parseInt(maxAge)) {
        e.preventDefault();
        alert('Maksimum yaş minimum yaşdan böyük olmalıdır.');
        return;
    }
    
    // Show loading state
    submitBtn.disabled = true;
    submitBtn.classList.add('loading');
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Yaradılır...</span>';
    
    // Re-enable button after timeout
    setTimeout(() => {
        submitBtn.disabled = false;
        submitBtn.classList.remove('loading');
        submitBtn.innerHTML = '<i class="fas fa-plus"></i><span>Aktivitə Yarat</span>';
    }, 60000);
});

// Clear validation messages on input
document.querySelectorAll('input, select, textarea').forEach(element => {
    element.addEventListener('input', function() {
        this.setCustomValidity('');
    });
});
</script>
{% endblock %}

